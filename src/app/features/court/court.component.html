<div class="min-h-screen background-body p-6 font-page">
  <h1 class="font-size-32 font-titles color-title mb-4">
    Tablero de Vóley
  </h1>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- BANQUILLO -->
    <div class="lg:col-span-1">
      <h2 class="font-size-20 font-subtitles color-subtitle mb-2">
        Banquillo
      </h2>

      <div
        cdkDropList
        id="benchList"
        [cdkDropListData]="(bench$ | async) ?? []"
        class="border border-color border-radius-15 p-3 background-white"
      >
        <div class="flex flex-col gap-2">
          <div
            *ngFor="let p of (bench$ | async) ?? []"
            cdkDrag
            (dblclick)="openStatsFor(p)"
          >
            <app-player-chip [player]="p"></app-player-chip>
          </div>
        </div>
      </div>

      <p class="font-size-12 color-pretitle mt-2">
        Doble clic en una ficha para abrir estadísticas.
      </p>
    </div>

    <!-- CAMPO -->
    <div class="lg:col-span-2">
      <h2 class="font-size-20 font-subtitles color-subtitle mb-2">
        Campo
      </h2>

      <div class="court-wrapper">
        <!-- Fondo madera -->
        <div class="court-wood">
          <!-- Rectángulo de la pista -->
          <div class="court-rect">
            <!-- Columnas interiores tipo imagen -->
            <div class="court-columns">
              <div class="court-column"></div>
              <div class="court-column"></div>
              <div class="court-column"></div>
            </div>

            <!-- Red central + postes -->
            <div class="court-net">
              <div class="net-line"></div>
              <div class="net-post net-post-top"></div>
              <div class="net-post net-post-bottom"></div>
            </div>

            <!-- POSICIONES SOLO EN NUESTRO CAMPO (MITAD IZQUIERDA) -->
            <div class="court-positions-grid">
              <ng-container *ngFor="let slot of (onCourt$ | async) ?? []; let idx = index">
                <div
                  class="court-position-cell"
                  cdkDropList
                  [id]="'pos-' + idx"
                  [cdkDropListData]="slot ? [slot] : []"
                  [cdkDropListConnectedTo]="['benchList']"
                  (cdkDropListDropped)="dropToPosition($event, idx)"
                >
                  <ng-container *ngIf="slot">
                    <div
                      cdkDrag
                      (dblclick)="openStatsFor(slot)"
                      class="flex flex-col items-center gap-1"
                    >
                      <app-player-chip [player]="slot"></app-player-chip>
                    </div>
                  </ng-container>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL DE ESTADÍSTICAS (con todos los stats, incluidos forced/unforced) -->
  <app-stats-panel
    *ngIf="selectedPlayer"
    [open]="openStats"
    [player]="selectedPlayer!"
    [matchId]="matchId"
    (close)="openStats = false"
  ></app-stats-panel>
</div>
