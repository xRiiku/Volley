<!-- court.component.html -->
<div class="flex flex-col gap-4">
  <section>
    <div class="flex items-center justify-center mb-2 gap-2">
      <div class="flex gap-2">
        <button
          type="button"
          class="px-3 py-1 rounded-10 border border-color text-14 background-white hover:background-gray"
          (click)="rotateLeft()"
        >
          ⟲ Rotar izquierda
        </button>

        <button
          type="button"
          class="px-3 py-1 rounded-10 border border-color text-14 background-corp color-text-light hover:background-corp-hover"
          (click)="rotateRight()"
        >
          Rotar derecha ⟳
        </button>
      </div>
    </div>

    <div cdkDropListGroup>
      <!-- PISTA -->
      <div class="court-wrapper">
        <div class="court-wood">
          <div class="court-rect">
            <div class="court-columns">
              <div class="court-column"></div>
              <div class="court-column"></div>
              <div class="court-column"></div>
            </div>

            <div class="court-net">
              <div class="net-line"></div>
              <div class="net-post net-post-top"></div>
              <div class="net-post net-post-bottom"></div>
            </div>

            <div class="court-positions-grid">
              <ng-container *ngFor="let slot of (onCourt$ | async) ?? []; let idx = index">
                <div
                  class="court-position-cell"
                  cdkDropList
                  [cdkDropListData]="(onCourt$ | async) ?? []"
                  (cdkDropListDropped)="dropToPosition($event, idx)"
                >
                  <ng-container *ngIf="slot">
                    <div
                      cdkDrag
                      [cdkDragData]="slot"
                      (click)="openStatsFor(slot)"
                      class="flex flex-col items-center gap-1"
                    >
                      <app-player-chip [player]="slot"></app-player-chip>
                    </div>
                  </ng-container>
                </div>
              </ng-container>
            </div>

          </div>
        </div>
      </div>

      <!-- BANQUILLO -->
      <section class="mt-4 w-full">
        <h2 class="font-size-20 font-subtitles color-subtitle mb-2">
          Banquillo
        </h2>

        <div class="flex justify-center">
          <div
            cdkDropList
            id="benchList"
            [cdkDropListData]="(bench$ | async) ?? []"
            (cdkDropListDropped)="dropToBench($event)"
            class="border border-color border-radius-15 p-3 background-white max-w-[640px] w-full"
          >
            <div class="bench-grid">
              <div
                *ngFor="let p of (bench$ | async) ?? []"
                cdkDrag
                [cdkDragData]="p"
                (click)="openStatsFor(p)"
              >
                <app-player-chip [player]="p"></app-player-chip>
              </div>
            </div>
          </div>
        </div>

        <p class="font-size-12 color-pretitle mt-2 text-center">
          Clic en una ficha para editar estadísticas.
        </p>
      </section>
    </div>
  </section>

  <!-- MODAL STATS -->
  <app-stats-panel
    *ngIf="selectedPlayer"
    [open]="openStats"
    [player]="selectedPlayer!"
    (close)="closeStats()"
  ></app-stats-panel>

  <!-- ✅ TOAST CAPITAN -->
  <div *ngIf="captainToastOpen" class="captain-toast-backdrop">
    <div class="captain-toast-dialog">
      <div class="captain-toast-header">
        <div class="captain-toast-title">Asignar nuevo capitán</div>

        <button
          type="button"
          class="px-3 py-1 rounded-10 border border-color text-14 background-white hover:background-gray"
          (click)="closeCaptainToast()"
        >
          Cerrar
        </button>
      </div>

      <div class="captain-toast-body">
        <p class="font-size-12 color-pretitle mb-3">
          El capitán actual va a salir. Elige quién será el nuevo capitán.
        </p>

        <div class="flex flex-wrap justify-center gap-3">
          <button
            *ngFor="let p of captainCandidates"
            type="button"
            class="captain-toast-option"
            (click)="chooseNewCaptainAndApply(p)"
          >
            <app-player-chip [player]="p"></app-player-chip>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ TOAST INFO (2 LIBEROS, ETC) -->
  <div *ngIf="infoToastOpen" class="captain-toast-backdrop">
    <div class="captain-toast-dialog">
      <div class="captain-toast-header">
        <div class="captain-toast-title">{{ infoToastTitle }}</div>

        <button
          type="button"
          class="px-3 py-1 rounded-10 border border-color text-14 background-white hover:background-gray"
          (click)="closeInfoToast()"
        >
          Cerrar
        </button>
      </div>

      <div class="captain-toast-body">
        <p class="font-size-12 color-pretitle">
          {{ infoToastMessage }}
        </p>
      </div>
    </div>
  </div>
</div>
